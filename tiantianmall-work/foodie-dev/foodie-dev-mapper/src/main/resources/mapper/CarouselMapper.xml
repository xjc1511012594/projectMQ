<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.imooc.mapper.CarouselMapper" >
  <resultMap id="BaseResultMap" type="com.imooc.pojo.Carousel" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="image_url" property="imageUrl" jdbcType="VARCHAR" />
    <result column="background_color" property="backgroundColor" jdbcType="VARCHAR" />
    <result column="item_id" property="itemId" jdbcType="VARCHAR" />
    <result column="cat_id" property="catId" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="sort" property="sort" jdbcType="INTEGER" />
    <result column="is_show" property="isShow" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>



      <select id="com.imooc.mapper.CarouselMapper.selectTotalCount" resultType="integer">
        SELECT count(*)
        FROM
        intf_prn_general_headers h1
        WHERE
        CONCAT(
        h1.gns_system_code,
        h1.gns_machine_no,DATE_FORMAT(h1.creation_date,'%Y%m%d')
        ) IN (
        SELECT
        CONCAT(
        h.gns_system_code,
        h.gns_machine_no,DATE_FORMAT(h.creation_date,'%Y%m%d')
        )
        FROM
        intf_prn_general_headers h
        WHERE
        h.re_print_flag NOT IN ('*', '%')
        AND h.gns_system_code <> ''
        AND h.line_count > 0
        AND h.trustee_unit = 'TLOG'
        AND  h.gns_machine_no <>''
        GROUP BY
        h.gns_system_code,
        h.gns_machine_no,DATE_FORMAT(h.creation_date,'%Y%m%d')
        HAVING COUNT(1) > 1
        )
        AND h1.creation_date > '2020-03-24'
        AND h1.transfer_status <>'S'
        ORDER BY  h1.gns_system_code,
        h1.gns_machine_no,h1.header_id;
      </select>

</mapper>